
> rest-express@1.0.0 dev
2:18:01 PM [express] serving on port 5000s
Browserslist: browsers data (caniuse-lite) is 10 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
2:18:06 PM [express] GET /api/auth/user 401 in 2ms :: {"message":"Unauthorized"}
2:18:06 PM [express] GET /api/user/details 401 in 0ms :: {"message":"Unauthorized"}
Getting user details for: 21869523
Getting user details for: 21869523
2:18:09 PM [express] GET /api/auth/user 304 in 229ms :: {"id":"21869523","email":"andrew@dcr.vc","fiâ€¦
2:18:09 PM [express] GET /api/user/details 304 in 526ms :: {"id":"21869523","email":"andrew@dcr.vc",â€¦
Getting user details for: 21869523
2:18:14 PM [express] GET /api/user/details 304 in 387ms :: {"id":"21869523","email":"andrew@dcr.vc",â€¦
Getting user details for: 21869523
2:18:20 PM [express] GET /api/user/details 304 in 376ms :: {"id":"21869523","email":"andrew@dcr.vc",â€¦
Getting user details for: 21869523
Getting user details for: 21869523
2:18:22 PM [express] GET /api/auth/user 304 in 94ms :: {"id":"21869523","email":"andrew@dcr.vc","firâ€¦
2:18:23 PM [express] GET /api/user/details 304 in 489ms :: {"id":"21869523","email":"andrew@dcr.vc",â€¦
Getting user details for: 21869523
2:18:26 PM [express] GET /api/user/details 304 in 416ms :: {"id":"21869523","email":"andrew@dcr.vc",â€¦
Getting user details for: 21869523
2:18:28 PM [express] GET /api/user/details 304 in 431ms :: {"id":"21869523","email":"andrew@dcr.vc",â€¦
Getting user details for: 21869523
2:18:31 PM [express] GET /api/user/details 304 in 412ms :: {"id":"21869523","email":"andrew@dcr.vc",â€¦
Getting user details for: 21869523
2:18:34 PM [express] GET /api/user/details 304 in 398ms :: {"id":"21869523","email":"andrew@dcr.vc",â€¦
Getting user details for: 21869523
2:18:37 PM [express] GET /api/user/details 304 in 413ms :: {"id":"21869523","email":"andrew@dcr.vc",â€¦
Getting user details for: 21869523
2:18:40 PM [express] GET /api/user/details 304 in 392ms :: {"id":"21869523","email":"andrew@dcr.vc",â€¦
Getting user details for: 21869523
2:18:41 PM [express] POST /api/create-subscription 200 in 555ms :: {"sessionId":"cs_test_a1IedSpnsnIâ€¦
Getting user details for: 21869523
2:18:43 PM [express] GET /api/user/details 304 in 409ms :: {"id":"21869523","email":"andrew@dcr.vc",â€¦
Getting user details for: 21869523
2:18:48 PM [express] GET /api/user/details 304 in 406ms :: {"id":"21869523","email":"andrew@dcr.vc",â€¦
ðŸ”” Webhook received! Headers: {
  signature: 't=1755958730,v1=e730a4f0e57d11c7f590a78ea0c31eb3157e950d0197092de04b7772bf4371f5,v0=0c24feb33b60eb4d61b2e94042b69931c0f33340ad737dba928d87a8deb98cd1',
  contentType: 'application/json; charset=utf-8',
  bodyLength: 3450
}
âœ… Webhook signature verified. Event type: checkout.session.completed
ðŸ“‹ Event data: {
  "id": "cs_test_a1IedSpnsnI8Wan35d0NVu6YW7trxUlj1g4cSzBN6x9WrQ8iKyIUlpn8ht",
  "object": "checkout.session",
  "adaptive_pricing": {
    "enabled": false
  },
  "after_expiration": null,
  "allow_promotion_codes": null,
  "amount_subtotal": 1700,
  "amount_total": 1700,
  "automatic_tax": {
    "enabled": false,
    "liability": null,
    "provider": null,
    "status": null
  },
  "billing_address_collection": null,
  "cancel_url": "https://72b7e87f-cee3-46f6-8a9a-935ead819261-00-2pbuxyzxmmug2.riker.replit.dev/subscription?cancelled=true",
  "client_reference_id": null,
  "client_secret": null,
  "collected_information": {
    "shipping_details": null
  },
  "consent": null,
  "consent_collection": null,
  "created": 1755958720,
  "currency": "usd",
  "currency_conversion": null,
  "custom_fields": [],
  "custom_text": {
    "after_submit": null,
    "shipping_address": null,
    "submit": null,
    "terms_of_service_acceptance": null
  },
  "customer": "cus_Sv8PqqY2X3VEW7",
  "customer_creation": null,
  "customer_details": {
    "address": {
      "city": null,
      "country": "AU",
      "line1": null,
      "line2": null,
      "postal_code": null,
      "state": null
    },
    "email": "andrew@dcr.vc",
    "name": "Andrew Julian",
    "phone": null,
    "tax_exempt": "none",
    "tax_ids": []
  },
  "customer_email": null,
  "discounts": [],
  "expires_at": 1756045120,
  "invoice": "in_1RzIHLKC0GXEXvjW8fynvxNq",
  "invoice_creation": null,
  "livemode": false,
  "locale": null,
  "metadata": {
    "userId": "21869523"
  },
  "mode": "subscription",
  "origin_context": null,
  "payment_intent": null,
  "payment_link": null,
  "payment_method_collection": "always",
  "payment_method_configuration_details": null,
  "payment_method_options": {
    "card": {
      "request_three_d_secure": "automatic"
    }
  },
  "payment_method_types": [
    "card"
  ],
  "payment_status": "paid",
  "permissions": null,
  "phone_number_collection": {
    "enabled": false
  },
  "recovered_from": null,
  "saved_payment_method_options": {
    "allow_redisplay_filters": [
      "always"
    ],
    "payment_method_remove": "disabled",
    "payment_method_save": null
  },
  "setup_intent": null,
  "shipping_address_collection": null,
  "shipping_cost": null,
  "shipping_options": [],
  "status": "complete",
  "submit_type": null,
  "subscription": "sub_1RzIHLKC0GXEXvjWmFWjY5pX",
  "success_url": "https://72b7e87f-cee3-46f6-8a9a-935ead819261-00-2pbuxyzxmmug2.riker.replit.dev/subscription-success?session_id={CHECKOUT_SESSION_ID}",
  "total_details": {
    "amount_discount": 0,
    "amount_shipping": 0,
    "amount_tax": 0
  },
  "ui_mode": "hosted",
  "url": null,
  "wallet_options": null
}
ðŸ›’ Processing checkout.session.completed event
Session details: {
  id: 'cs_test_a1IedSpnsnI8Wan35d0NVu6YW7trxUlj1g4cSzBN6x9WrQ8iKyIUlpn8ht',
  customer: 'cus_Sv8PqqY2X3VEW7',
  subscription: 'sub_1RzIHLKC0GXEXvjWmFWjY5pX',
  metadata: { userId: '21869523' },
  paymentStatus: 'paid'
}
ðŸ‘¤ Updating subscription for user: 21869523
âœ… User subscription updated successfully
2:18:50 PM [express] POST /api/stripe-webhook 200 in 41ms :: {"received":true}
ðŸ”” Webhook received! Headers: {
  signature: 't=1755958730,v1=d88910e6b36c2b41806174c9ff6b64e029bd3cd2d99829d12507a02998a4df1c,v0=b209a133c387ff4f0f24e44d33f64ab0b2e6bf520856396410aa2ec21b5d860b',
  contentType: 'application/json; charset=utf-8',
  bodyLength: 5699
}
âœ… Webhook signature verified. Event type: customer.subscription.updated
ðŸ“‹ Event data: {
  "id": "sub_1RzIHLKC0GXEXvjWmFWjY5pX",
  "object": "subscription",
  "application": null,
  "application_fee_percent": null,
  "automatic_tax": {
    "disabled_reason": null,
    "enabled": false,
    "liability": null
  },
  "billing_cycle_anchor": 1755958727,
  "billing_cycle_anchor_config": null,
  "billing_mode": {
    "type": "classic"
  },
  "billing_thresholds": null,
  "cancel_at": null,
  "cancel_at_period_end": false,
  "canceled_at": null,
  "cancellation_details": {
    "comment": null,
    "feedback": null,
    "reason": null
  },
  "collection_method": "charge_automatically",
  "created": 1755958727,
  "currency": "usd",
  "customer": "cus_Sv8PqqY2X3VEW7",
  "days_until_due": null,
  "default_payment_method": "pm_1RzIHKKC0GXEXvjWgPAdqDx7",
  "default_source": null,
  "default_tax_rates": [],
  "description": null,
  "discounts": [],
  "ended_at": null,
  "invoice_settings": {
    "account_tax_ids": null,
    "issuer": {
      "type": "self"
    }
  },
  "items": {
    "object": "list",
    "data": [
      {
        "id": "si_Sv8YRX3jgssk6I",
        "object": "subscription_item",
        "billing_thresholds": null,
        "created": 1755958728,
        "current_period_end": 1787494727,
        "current_period_start": 1755958727,
        "discounts": [],
        "metadata": {},
        "plan": {
          "id": "price_1RzIHEKC0GXEXvjWAtiuxaGk",
          "object": "plan",
          "active": false,
          "amount": 1700,
          "amount_decimal": "1700",
          "billing_scheme": "per_unit",
          "created": 1755958720,
          "currency": "usd",
          "interval": "year",
          "interval_count": 1,
          "livemode": false,
          "metadata": {},
          "meter": null,
          "nickname": null,
          "product": "prod_Sv6fK4x9RCRuaM",
          "tiers_mode": null,
          "transform_usage": null,
          "trial_period_days": null,
          "usage_type": "licensed"
        },
        "price": {
          "id": "price_1RzIHEKC0GXEXvjWAtiuxaGk",
          "object": "price",
          "active": false,
          "billing_scheme": "per_unit",
          "created": 1755958720,
          "currency": "usd",
          "custom_unit_amount": null,
          "livemode": false,
          "lookup_key": null,
          "metadata": {},
          "nickname": null,
          "product": "prod_Sv6fK4x9RCRuaM",
          "recurring": {
            "interval": "year",
            "interval_count": 1,
            "meter": null,
            "trial_period_days": null,
            "usage_type": "licensed"
          },
          "tax_behavior": "unspecified",
          "tiers_mode": null,
          "transform_quantity": null,
          "type": "recurring",
          "unit_amount": 1700,
          "unit_amount_decimal": "1700"
        },
        "quantity": 1,
        "subscription": "sub_1RzIHLKC0GXEXvjWmFWjY5pX",
        "tax_rates": []
      }
    ],
    "has_more": false,
    "total_count": 1,
    "url": "/v1/subscription_items?subscription=sub_1RzIHLKC0GXEXvjWmFWjY5pX"
  },
  "latest_invoice": "in_1RzIHLKC0GXEXvjW8fynvxNq",
  "livemode": false,
  "metadata": {},
  "next_pending_invoice_item_invoice": null,
  "on_behalf_of": null,
  "pause_collection": null,
  "payment_settings": {
    "payment_method_options": {
      "acss_debit": null,
      "bancontact": null,
      "card": {
        "network": null,
        "request_three_d_secure": "automatic"
      },
      "customer_balance": null,
      "konbini": null,
      "sepa_debit": null,
      "us_bank_account": null
    },
    "payment_method_types": [
      "card"
    ],
    "save_default_payment_method": "off"
  },
  "pending_invoice_item_interval": null,
  "pending_setup_intent": null,
  "pending_update": null,
  "plan": {
    "id": "price_1RzIHEKC0GXEXvjWAtiuxaGk",
    "object": "plan",
    "active": false,
    "amount": 1700,
    "amount_decimal": "1700",
    "billing_scheme": "per_unit",
    "created": 1755958720,
    "currency": "usd",
    "interval": "year",
    "interval_count": 1,
    "livemode": false,
    "metadata": {},
    "meter": null,
    "nickname": null,
    "product": "prod_Sv6fK4x9RCRuaM",
    "tiers_mode": null,
    "transform_usage": null,
    "trial_period_days": null,
    "usage_type": "licensed"
  },
  "quantity": 1,
  "schedule": null,
  "start_date": 1755958727,
  "status": "active",
  "test_clock": null,
  "transfer_data": null,
  "trial_end": null,
  "trial_settings": {
    "end_behavior": {
      "missing_payment_method": "create_invoice"
    }
  },
  "trial_start": null
}
ðŸ”„ Processing customer.subscription.updated event
/home/runner/workspace/node_modules/src/pg-core/columns/timestamp.ts:66
        return value.toISOString();
                     ^


RangeError: Invalid time value
    at Date.toISOString (<anonymous>)
    at PgTimestamp.mapToDriverValue (/home/runner/workspace/node_modules/src/pg-core/columns/timestamp.ts:66:16)
    at <anonymous> (/home/runner/workspace/node_modules/src/sql/sql.ts:223:69)
    at Array.map (<anonymous>)
    at SQL.buildQueryFromSourceParams (/home/runner/workspace/node_modules/src/sql/sql.ts:148:30)
    at <anonymous> (/home/runner/workspace/node_modules/src/sql/sql.ts:174:17)
    at Array.map (<anonymous>)
    at SQL.buildQueryFromSourceParams (/home/runner/workspace/node_modules/src/sql/sql.ts:148:30)
    at <anonymous> (/home/runner/workspace/node_modules/src/sql/sql.ts:174:17)
    at Array.map (<anonymous>)
    at SQL.buildQueryFromSourceParams (/home/runner/workspace/node_modules/src/sql/sql.ts:148:30)
    at <anonymous> (/home/runner/workspace/node_modules/src/sql/sql.ts:124:23)
    at Object.startActiveSpan (/home/runner/workspace/node_modules/src/tracing.ts:27:11)
    at SQL.toQuery (/home/runner/workspace/node_modules/src/sql/sql.ts:123:17)
    at PgDialect.sqlToQuery (/home/runner/workspace/node_modules/src/pg-core/dialect.ts:591:14)
    at QueryPromise._prepare (/home/runner/workspace/node_modules/src/pg-core/query-builders/update.ts:579:18)
    at QueryPromise.execute (/home/runner/workspace/node_modules/src/pg-core/query-builders/update.ts:596:15)
    at QueryPromise.then (/home/runner/workspace/node_modules/src/query-promise.ts:31:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
